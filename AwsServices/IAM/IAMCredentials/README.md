# IAM Credentials

## IAM Login Profile
In AWS, a login profile refers to the credentials (username and password) that allow a user to sign in to the AWS Management Console. Not all 
IAM users have access to the AWS console


To allow an IAM User access via the AWS console, you can do it from the user's Security Credentials tab or via the AWS CLI.
```bash
aws iam create-login-profile --user UserTest --password "Pass123!"
```

Command to change the user's password
```bash
aws iam update-login-profile --user UserTest --password "NewPass789"
``` 

---

### Account Password Policy

AWS allows account administrators to configure a basic password complexity policy for IAM users. This policy defines requirements such as minimum length, use of uppercase letters, numbers, and special characters.

The current password policy can be retrieved using the AWS CLI:

```bash
aws iam get-account-password-policy
``` 
--- 

## AWS API ACCESS KEY
Access keys are long-term credentials for an IAM user or the AWS account root user. 

Theare're two types of access keys:

- Long-term access keys do not expire, but it is good practice to change them regularly.

- Temporary credentials are short-term, generated dynamically, and typically obtained through the AWS Security Token Service (STS) or AWS IAM Identity Center. 


## Long-term access keys 
Long-term access keys can be active or inactive. 

How to disable an AWS Acess key via AWS CLI:
```bash 
aws iam update-access-key --access-key-id AKIA... --status Inactive
``` 
(Long-term access keys begin with the string AKIA.)

How to active an AWS Acess key via AWS CLI:
```bash
aws iam update-access-key --access-key-id AKIA... --status Active
``` 

To delete an AWS Access Key:
```bash
aws iam delete-access-key --access-key-id AKIA...
```

Long-term credentials can be created via the AWS Console or the AWS CLI:
```bash
 aws iam create-access-key --user-name User123

 {
    "AccessKey": {
        "UserName": "User123",
        "AccessKeyId": "AKIA***********",
        "Status": "Active",
        "SecretAccessKey": "****************",
        "CreateDate": "2024-11-22T10:01:07+00:00"
    }
```

Short-term credentials in AWS are issued on demand and are generated by the AWS Security Token Service (STS). These temporary credentials are commonly used for role assumption and secure, time-limited access to resources.

How to get Short-term keys via AWS CLI:
```bash 
aws sts get-session-token

{
    {
    "Credentials": {
        "SecretAccessKey": "**********",
        "SessionToken": "***********",
        "Expiration": "2026-02-15T11:44:30Z"
    }
}
```

How to identify a user by `AccessKeyId`: 
```bash 
 aws sts get-access-key-info --access-key-id ASIA****                                                             
{
    "Account": "************"
}
``` 

___
### Multi-Factor Authentication (MFA)

Multi-Factor Authentication (MFA) adds an additional layer of security beyond a username and password. In AWS, MFA requires users to provide a second form of verification, such as a time-based one-time password (TOTP), when authenticating.

From a security perspective, enabling MFA significantly reduces the risk of account compromise, even if credentials are leaked or exposed.

___
## How Aws services get these credentials ?
-  # Static Credentials (IAM User)
   
   Are created manually in AWS Identity and Access Management. 

- # IAM Role (The safest way)

   This is the most modern and recommended way 
   *  Assume a Role
   *  Receive temporary credentials 
   *  Use these credentials for a limited time 

   Example:

   1 - Create a trust policy :
   ```json
   {
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "ec2.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
   ]
  }

   ```

  2 - Create a role: 
    ```bash
    aws iam create-role  --role-name EC2SecurityRole --assume-role-policy-document file://trust-policy.json
    ```

   3 - Attach a policy:
   ```bash
   aws iam attach-role-policy --role-name EC2SecurityRole  --policy-arn arn:aws:iam::aws:policy/AmazonS3ReadOnlyAccess
   ```

   And now how the role generate the credentials:
   ```bash
   aws sts assume-role  --role-arn arn:aws:iam::123456789012:role/EC2SecurityRole --role-session-name test-session

   
  "Credentials": {
    "AccessKeyId": "ASIAEXAMPLEKEY",
    "SecretAccessKey": "temporarySecretKey",
    "SessionToken": "temporarySessionToken",
    "Expiration": "2026-02-14T18:00:00Z"
    }
  
  ```
  
- # STS - temporary credentials
  ```bash
  aws sts get-session-token
  aws sts assume-role
  ```

- # Instance Metadata Service (IMDS)

  When an EC2 instance has an associated role, it queries:
  `http://169.254.169.254` 

  and receives temporary credentials.

  
  This mechanism has already been exploited multiple times via SSRF.

- # Enviorment variables 
   Very common in containers, lambda and applications.

   Example: 

   `AWS_ACCESS_KEY_ID` 

   `AWS_SECRET_ACCESS_KEY`
